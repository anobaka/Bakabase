# 批量修改文件名功能需求文档

## 功能概述
FileNameModifierModal 是一个用于批量修改文件名的模态框组件，支持多种文件命名操作和实时预览功能。该组件提供了直观的界面来配置复杂的文件名修改操作，并支持实时预览修改结果。

## 核心功能

### 1. 文件命名操作
支持以下七种操作类型：

- **插入操作 (Insert)**: 在指定位置插入新文本
  - 支持位置：开始、结束、指定索引、匹配文本前后
  - 可配置插入文本和目标匹配文本

- **添加日期时间 (AddDateTime)**: 在文件名中添加日期时间信息
  - 支持自定义日期时间格式
  - 可配置插入位置

- **删除操作 (Delete)**: 删除文件名中的指定内容
  - 支持删除类型：全部删除、从开始删除、从结束删除、匹配文本前后删除、指定位置删除
  - 可配置删除数量和起始位置

- **替换操作 (Replace)**: 将文件名中的指定文本替换为新文本
  - 支持精确匹配和模糊匹配
  - 可选择是否替换整个文件名

- **大小写转换 (ChangeCase)**: 转换文件名的大小写格式
  - 支持：TitleCase、UpperCase、LowerCase、CamelCase、PascalCase

- **添加字母序列 (AddAlphabetSequence)**: 添加字母序列到文件名
  - 可配置起始字符和序列长度

- **反转操作 (Reverse)**: 反转文件名

### 2. 用户界面特性
- **左右分栏布局**: 
  - 左侧：操作配置区域，支持多操作链式配置
  - 右侧：文件路径输入/预览区域
- **实时预览**: 显示修改前后的文件名对比，自动更新
- **初始文件列表**: 始终显示已确认的文件列表，即使没有执行修改操作
- **路径前缀优化**: 自动检测并弱化显示公共路径前缀，减少视觉干扰
- **输入模式切换**: 支持在手动输入和预览显示之间切换
- **紧凑配置界面**: 根据操作类型动态显示相关配置字段
- **长路径优化**: 智能截断长路径，支持显示完整路径
- **响应式显示**: 自适应不同屏幕尺寸，优化移动设备体验

### 3. 操作配置选项
- **操作类型选择**: 七种不同的操作类型
- **位置控制**: 支持多种位置类型（开始、结束、匹配前后、指定索引）
- **文本匹配**: 支持精确匹配和模糊匹配
- **数量控制**: 删除操作支持配置删除数量
- **格式控制**: 日期时间格式、大小写类型、字母序列配置
- **链式操作**: 支持多个操作按顺序执行

### 4. 文件路径处理
- **批量输入**: 支持多行文件路径输入
- **路径验证**: 自动验证文件路径的有效性
- **预览展示**: 清晰展示修改前后的文件名对比
- **相对路径显示**: 智能显示相对路径，突出文件名变化

## 技术实现

### 组件架构
- 基于 React + TypeScript 开发
- 使用 bakaui 组件库构建界面
- 集成 react-i18next 实现国际化
- 使用 HeroUI 框架，兼容移动设备

### 核心状态管理
```typescript
interface FileNameModifierModalProps extends DestroyableProps {
  onClose: () => void;
  initialFilePaths?: string[]; // 可选的初始文件路径列表
}

interface FileNameModificationResult {
  originalPath: string;
  modifiedPath: string;
  originalFileName: string;
  modifiedFileName: string;
  commonPrefix: string;
  originalRelative: string;
  modifiedRelative: string;
}
```

### 操作配置结构
```typescript
interface FileNameModifierOperation {
  target: number;
  operation: number; // 操作类型
  position: number; // 位置类型
  positionIndex: number; // 位置索引
  targetText: string; // 目标文本
  text: string; // 操作文本
  deleteCount: number; // 删除数量
  deleteStartPosition: number; // 删除起始位置
  caseType: number; // 大小写类型
  dateTimeFormat: string; // 日期时间格式
  alphabetStartChar: string; // 字母序列起始字符
  alphabetCount: number; // 字母序列长度
  replaceEntire: boolean; // 是否替换整个文件名
}
```

### 主要功能模块
1. **操作配置模块**: 处理用户选择的修改操作和参数，支持动态字段显示
2. **文件路径处理模块**: 解析和验证输入的文件路径
3. **预览生成模块**: 根据配置生成修改后的文件名预览
4. **路径优化模块**: 检测和弱化公共路径前缀
5. **验证模块**: 操作配置的实时验证
6. **API集成模块**: 与后端API交互进行预览和执行操作

## 用户体验设计

### 界面布局
- **响应式设计**: 适配不同屏幕尺寸，兼容移动设备
- **直观操作**: 清晰的操作流程和视觉反馈
- **实时反馈**: 即时显示操作结果
- **紧凑布局**: 优化空间利用，减少滚动

### 交互设计
- **一键切换**: 输入和预览模式快速切换
- **批量处理**: 支持大量文件路径的批量处理
- **错误处理**: 友好的错误提示和验证
- **自动预览**: 配置变更时自动触发预览更新
- **操作链**: 支持多个操作按顺序执行

### 视觉设计
- **卡片式布局**: 每个操作配置使用卡片展示
- **颜色编码**: 使用不同颜色区分操作类型
- **图标支持**: 使用图标增强视觉识别
- **状态指示**: 清晰的加载和错误状态显示
- **路径显示优化**: 
  - 智能路径截断算法，保留文件名和关键路径信息
  - 悬停工具提示显示完整路径
  - 全局路径显示模式切换

## 国际化支持
- 支持中英文界面切换
- 所有用户界面文本都通过 i18n 系统管理
- 翻译键值统一管理在 localization 文件中
- 支持操作类型、位置类型、大小写类型等枚举值的翻译

## 扩展性
- 模块化设计，易于添加新的操作类型
- 支持自定义大小写转换规则
- 可扩展的文件路径处理逻辑
- 灵活的操作配置结构
- 支持自定义验证规则

## 使用场景
1. **媒体文件整理**: 批量重命名图片、视频文件，添加日期时间信息
2. **文档管理**: 统一文档命名规范，转换大小写格式
3. **代码文件处理**: 批量修改代码文件命名，添加序列号
4. **数据文件整理**: 规范化数据文件命名格式
5. **备份文件处理**: 批量处理备份文件的命名规则
6. **多媒体库管理**: 为媒体文件添加分类标识或序列号
7. **测试和演示**: 提供丰富的测试文件路径用于功能测试和演示

## 测试支持
- 支持通过 `initialFilePaths` 属性传入测试文件路径
- 提供多种类型的测试文件路径（图片、视频、音乐、文档、代码等）
- 自动初始化文件列表，便于快速测试各种操作类型

## 长路径显示优化

### 问题背景
当文件路径过长时，传统的水平布局会导致路径超出显示区域，影响用户体验。

### 优化方案

#### 1. **智能路径截断**
- 保留文件名和父目录信息
- 使用省略号（...）表示截断部分
- 优先保留路径的末尾部分（文件名和父目录）
- 确保文件名完整显示
- 最大长度限制为40字符，确保在容器内正确显示
- **路径内容自动换行，绝不超出modal范围**

#### 4. **全局显示模式**
- 一键切换完整路径/截断路径显示
- 全局状态管理，影响所有文件项
- 提供视觉反馈和状态指示

#### 5. **响应式布局**
- 自适应不同屏幕尺寸
- 移动设备优化显示
- 支持触摸操作和手势

### 交互设计
- **悬停效果**: 鼠标悬停时高亮显示
- **工具提示**: 悬停显示完整路径
- **状态切换**: 全局路径显示模式切换
- **视觉反馈**: 清晰的状态指示和操作反馈
- **自动换行**: 路径内容在预览区内自动换行，保证不会横向滚动或溢出

## 技术特性
- **类型安全**: 完整的TypeScript类型定义
- **性能优化**: 使用useCallback和useMemo优化渲染性能
- **错误边界**: 完善的错误处理和用户提示
- **API集成**: 与后端API的完整集成
- **状态管理**: 高效的状态管理和更新机制
- **路径处理算法**: 智能路径截断和前缀检测算法
- **响应式设计**: 适配不同屏幕尺寸和设备类型

### 预览区显示优化
- 预览主行仅展示文件名变化（原文件名 → 新文件名），不显示路径
- 每行更紧凑（小字体、低行高、窄间距），便于一屏显示更多内容
- 显示完整路径时，相同路径前缀弱化显示，突出变化部分

## 新增特性与优化

### 移动端与响应式支持
- 主界面采用 flex 布局，宽屏为左右分栏，窄屏自动纵向排列，适配手机和平板。
- 所有按钮、输入区、操作卡片等在小屏下宽度自适应，触控友好。
- 主要交互元素均加 aria-label，支持键盘操作和无障碍辅助。

### 文件路径输入区增强
- 新增“去重”、“清空”、“粘贴”按钮，支持一键去重、清空、从剪贴板批量粘贴路径。
- 粘贴时自动分行、去重、去空。
- 前端校验路径格式（非空、无非法字符），错误友好提示。

### 操作项交互增强
- 支持操作项的上移、下移、复制、折叠/展开、删除。
- 所有参数输入、按钮、错误提示均支持国际化。
- 主要交互元素均加 aria-label，便于无障碍和自动化测试。

### 国际化与无障碍
- 所有按钮、提示、错误信息、枚举值等均用 i18n key，支持中英文切换。
- 主要交互元素加 aria-label，支持屏幕阅读器和键盘操作。
